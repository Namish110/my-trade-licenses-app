<div class="approver-dashboard">
  <section class="hero-card">
    <div>
      <p class="eyebrow">Approver Control Panel</p>
      <h2>License Decisions Overview</h2>
      <p class="subtext">Real-time count summary for applied, objection, and rejected applications.</p>
    </div>
    <button class="btn btn-light btn-sm" (click)="loadDashboard()" [disabled]="isLoading">
      {{ isLoading ? 'Refreshing...' : 'Refresh Counts' }}
    </button>
  </section>

  <section class="status-strip" *ngIf="!loadError">
    <span>Last updated: {{ lastUpdated | date: 'dd MMM yyyy, hh:mm a' }}</span>
    <span>Coverage: {{ accountedPercent | number : '1.0-1' }}%</span>
  </section>

  <section class="error-state" *ngIf="loadError">
    <span>{{ loadError }}</span>
    <button class="btn btn-outline-danger btn-sm" (click)="loadDashboard()">Try Again</button>
  </section>

  <section class="kpi-grid" *ngIf="!loadError">
    <article class="kpi-card grand">
      <span>Grand Total</span>
      <h3>{{ formatNumber(stats.GrandTotal) }}</h3>
      <small>All applications in scope</small>
    </article>

    <article class="kpi-card applied" [routerLink]="['/approver/approving-officer']" [queryParams]="{ statusId: 2 }">
      <span>Total Applied</span>
      <h3>{{ formatNumber(stats.TotalApplied) }}</h3>
      <small>{{ totalAppliedPercent | number : '1.0-1' }}% of total</small>
    </article>

    <article class="kpi-card objection" [routerLink]="['/approver/approving-officer']" [queryParams]="{ statusId: 5 }">
      <span>Total Objection</span>
      <h3>{{ formatNumber(stats.TotalObjection) }}</h3>
      <small>{{ totalObjectionPercent | number : '1.0-1' }}% of total</small>
    </article>

    <article class="kpi-card rejected" [routerLink]="['/approver/approving-officer']" [queryParams]="{ statusId: 4 }">
      <span>Total Rejected</span>
      <h3>{{ formatNumber(stats.TotalRejected) }}</h3>
      <small>{{ totalRejectedPercent | number : '1.0-1' }}% of total</small>
    </article>
  </section>

  <section class="insight-grid" *ngIf="!loadError">
    <article class="panel distribution">
      <header>Application Distribution</header>
      <div class="ring-wrap">
        <div
          class="progress-ring"
          [style.--applied]="totalAppliedPercent"
          [style.--objection]="totalObjectionPercent"
          [style.--rejected]="totalRejectedPercent"
        >
          <div class="ring-center">
            <strong>{{ stats.GrandTotal ? (accountedPercent | number : '1.0-0') : '0' }}%</strong>
            <span>Accounted</span>
          </div>
        </div>
        <div class="legend">
          <div><span class="dot applied"></span>Applied: {{ formatNumber(stats.TotalApplied) }}</div>
          <div><span class="dot objection"></span>Objection: {{ formatNumber(stats.TotalObjection) }}</div>
          <div><span class="dot rejected"></span>Rejected: {{ formatNumber(stats.TotalRejected) }}</div>
        </div>
      </div>
    </article>

    <article class="panel actions">
      <header>Quick Actions</header>
      <div class="queue">
        <div class="queue-item warning">
          <a [routerLink]="['/approver/approving-officer']" [queryParams]="{ statusId: 2 }">
            Applied pending review: {{ formatNumber(stats.TotalApplied) }}
          </a>
        </div>
        <div class="queue-item info">
          <a [routerLink]="['/approver/approving-officer']" [queryParams]="{ statusId: 5 }">
            Objection cases to resolve: {{ formatNumber(stats.TotalObjection) }}
          </a>
        </div>
        <div class="queue-item danger">
          <a [routerLink]="['/approver/approving-officer']" [queryParams]="{ statusId: 4 }">
            Rejected cases recorded: {{ formatNumber(stats.TotalRejected) }}
          </a>
        </div>
      </div>
      <a class="btn btn-outline-primary btn-sm w-100 mt-2" routerLink="/approver/approving-officer">
        Open Approval Workflow
      </a>
    </article>
  </section>

  <section class="loading-state" *ngIf="isLoading">
    <div class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></div>
    <span>Loading latest approver dashboard data...</span>
  </section>
</div>
