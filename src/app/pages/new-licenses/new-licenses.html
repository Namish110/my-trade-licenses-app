<div class="container my-5">
  <div class="card shadow-lg border-0 rounded-4 overflow-hidden">

    <!-- HEADER -->
    <div class="card-header text-white py-3">
      <h4 class="mb-0">New Trade License Registration</h4>
      <small>Greater Bengaluru Authority</small>
    </div>

    <div class="card-body">
<div *ngIf="currentStep === 0">
  <h6>
    {{ infoAboutIssueRelated }}
  </h6>
  <h5 class="text-center fw-bold mb-3">
    DECLARATION BY APPLICANT
  </h5>

  <div class="alert alert-light border">
    <ol class="small">
      <li>{{ infoAboutRules1 }}</li>
      <li>{{ infoAboutRules2 }}</li>
      <li>{{ infoAboutRules3 }}</li>
      <li>{{ infoAboutRules4 }}</li>
      <li>{{ infoAboutRules5 }}</li>
      <li>{{ infoAboutRules6 }}</li>
    </ol>
  </div>

  <div class="form-check mb-4">
    <input class="form-check-input" type="checkbox" [(ngModel)]="agree">
    <label class="form-check-label fw-semibold">
      I/We hereby agree to the above terms and conditions
    </label>
  </div>

  <div class="text-center">
    <button class="btn btn-primary btn-lg"
            [disabled]="!agree"
            (click)="startApplication()">
      Continue ‚Üí
    </button>
  </div>

</div>

      <!-- ================= STEPPER ================= -->
      <!-- ================= STEPPER ================= -->
<div *ngIf="currentStep > 0" class="stepper-container mb-4">

  <div class="step" [class.active]="currentStep >= 1">
    <div class="circle">1</div>
    <span>Basic</span>
  </div>

  <div class="line" [class.active]="currentStep >= 2"></div>

  <div class="step" [class.active]="currentStep >= 2">
    <div class="circle">2</div>
    <span>Trade</span>
  </div>

  <div class="line" [class.active]="currentStep >= 3"></div>

  <div class="step" [class.active]="currentStep >= 3">
    <div class="circle">3</div>
    <span>Fee</span>
  </div>

  <div class="line" [class.active]="currentStep >= 4"></div>

  <div class="step" [class.active]="currentStep >= 4">
    <div class="circle">4</div>
    <span>Location</span>
  </div>

</div>


      <!-- ======================================================
           STEP 1 ‚Äì BASIC DETAILS
      ======================================================= -->
      <div [hidden]="currentStep !== 1">
        <h5 class="section-title required">Applicant Representation</h5>
        <div class="mb-3">
          <label class="form-check form-check-inline" *ngFor="let r of representations">
            <input type="radio" class="form-check-input" name="rep">
            {{ r }}
          </label>
        </div>

        <h5 class="section-title">Trade Details</h5>
        <div class="row g-3">
          <div class="col-md-4">
            <label class="required">Trade Type</label>
            <select class="form-select" [(ngModel)]="selectedTradeType">
              <option [ngValue]="null">Select</option>
              <option *ngFor="let trade of tradeTypes" [ngValue]="trade">
                {{ trade.tradeTypeName }}
              </option>
            </select>
          </div>
          <div class="col-md-4">
            <label class="required">Trade Name</label>
            <input class="form-control" id="tradeName" [(ngModel)]="tradeLicenseApplicationDetails.tradeName">
          </div>
          <div class="col-md-4">
            <label class="required">Application Name</label>
            <input class="form-control" id="applicationName" [(ngModel)]="tradeLicenseApplicationDetails.applicantName">
          </div>
        </div>
        <div class="row g-3">
          <div class="col-md-4">
            <label>Email</label>
            <input class="form-control" [(ngModel)]="tradeLicenseApplicationDetails.emailID">
          </div>
          <div class="col-md-4">
            <label class="required">Mobile No.</label>
            <input class="form-control"
              type="text"
              maxlength="10"
              [(ngModel)]="tradeLicenseApplicationDetails.mobileNumber"
              name="mobileNo">
          </div>
          <div class="col-md-4">
            <label>Telephone No.</label>
            <input class="form-control" [(ngModel)]="tradeLicenseApplicationDetails.landLineNumber">
          </div>
        </div>
        <div class="row g-3">
          <div class="col-md-4">
            <label class="required">MLA Constituency</label>
            <select class="form-select" [(ngModel)]="selectedMLAConstituency" (change)="onMLAConstituencyChange()">
              <option [ngValue]="null">Select</option>
              <option *ngFor="let mla of mlaConstituencies" [ngValue]="mla">
                {{ mla.mohName }}
              </option>
            </select>
          </div>
          <div class="col-md-4">
            <label class="required">Ward</label>
            <select class="form-select" [(ngModel)]="selectedWard" [disabled]="!selectedMLAConstituency">
              <option [ngValue]="null">Select</option>
              <option *ngFor="let w of wards" [ngValue]="w">
                {{ w.wardName }}
              </option>
            </select>
          </div>
          <div class="col-md-4">
            <label class="required">BESCOM RR No.</label>
            <input class="form-control" id="bescom" [(ngModel)]="tradeLicenseApplications.bescomRRNumber">
          </div>
        </div>

        <h5 class="section-title mt-4">Address Information</h5>
        <div class="row g-3">
          <!-- <div class="col-md-3"><input class="form-control" placeholder="Ward"></div> -->
          <div class="col-md-3"><input class="form-control" placeholder="Door No *" id="doorNo" [(ngModel)]="tradeLicenseApplicationDetails.doorNumber"></div>
          <div class="col-md-3"><input class="form-control" placeholder="Street *" id="street" [(ngModel)]="tradeLicenseApplicationDetails.address1"></div>
          <div class="col-md-3"><input class="form-control" placeholder="Area *" id="area" [(ngModel)]="tradeLicenseApplicationDetails.address2"></div>
          <div class="col-md-3"><input class="form-control" placeholder="Pincode *" id="pincode" [(ngModel)]="tradeLicenseApplicationDetails.pincode"></div>
        </div>

        <div class="text-end mt-4">
          <button class="btn btn-primary btn-lg" (click)="nextStep()">
            Continue ‚Üí
          </button>
        </div>
      </div>

      <!-- ======================================================
           STEP 2 ‚Äì TRADE
      ======================================================= -->
      <div *ngIf="currentStep === 2">

        <h5 class="section-title">Trade Classification (Schedule X)</h5>

        <div class="row g-3 align-items-end">
          <div class="col-md-4">
            <label class="required">Major Trade</label>
            <select class="form-select"
                    [(ngModel)]="selectedMajor"
                    (change)="onMajorChange()">
              <option [ngValue]="null">Select</option>
              <option *ngFor="let m of tradeMajors" [ngValue]="m">
                {{ m.tradeMajorName }}
              </option>
            </select>
          </div>

          <div class="col-md-4">
            <label class="required">Minor Trade</label>
            <select class="form-select"
                    [(ngModel)]="selectedMinor"
                    (change)="onMinorChange()"
                    [disabled]="!selectedMajor">
              <option [ngValue]="null">Select</option>
              <option *ngFor="let mi of tradeMinors" [ngValue]="mi">
                {{ mi.tradeMinorName }}
              </option>
            </select>
          </div>

          <div class="col-md-4">
            <label class="required">Sub Trade</label>
            <select class="form-select"
                    [(ngModel)]="selectedSub"
                    [disabled]="!selectedMinor">
              <option [ngValue]="null">Select</option>
              <option *ngFor="let s of tradeSubs" [ngValue]="s">
                {{ s.tradeSubName }}
              </option>
            </select>
          </div>
        </div>

        <div class="mt-3">
          <strong>Rate:</strong> {{ '--' }}
          <button class="btn btn-primary ms-3" (click)="addTrade()">Add</button>
        </div>

        <table class="table table-bordered mt-3" *ngIf="tradeGrid.length">
          <thead class="table-primary">
            <tr>
              <th>#</th>
              <th>Major</th>
              <th>Minor</th>
              <th>Sub</th>
              <th>Rate</th>
              <th>Action</th>
            </tr>
          </thead>
          <tr *ngFor="let t of tradeGrid; let i = index">
            <td>{{ i+1 }}</td>
            <td>{{ t.major }}</td>
            <td>{{ t.minor }}</td>
            <td>{{ t.sub }}</td>
            <td>{{ t.rate }}</td>
            <td>
              <button class="btn btn-danger btn-sm" (click)="removeTrade(i)">
                Remove
              </button>
            </td>
          </tr>
          <tfoot>
            <tr>
              <th colspan="4" class="text-end">Total</th>
              <th>{{ totalAmount }}</th>
              <th></th>
            </tr>
          </tfoot>
        </table>

        <div class="d-flex justify-content-between mt-4">
          <button class="btn btn-outline-secondary" (click)="prevStep()">‚Üê Back</button>
          <button class="btn btn-primary" (click)="nextStep()">Continue ‚Üí</button>
        </div>
      </div>

      <!-- ======================================================
           STEP 3 ‚Äì FEE
      ======================================================= -->
      <div *ngIf="currentStep === 3">

        <h5 class="section-title">Application & Fee Details</h5>

        <div class="row g-3">
          <div class="col-md-4">
            <label class="required">Jurisdiction of Health Officer (Zone)</label>
            <select class="form-select" [(ngModel)]="selectedZone">
              <option [ngValue]="null">Select</option>
              <option *ngFor="let z of zones" [ngValue]="z">
                {{ z.zoneName }}
              </option>
            </select>
          </div>
          <div class="col-md-4">
            <label class="required">Date of Application</label>
            <input class="form-control" [value]="applicationDate" readonly>
          </div>
          <!-- <div class="col-md-4">
            <label>Proposed Commencement</label>
            <input type="date" class="form-control" [(ngModel)]="commencementDate">
          </div> -->
          <div class="col-md-4">
            <label>Proposed Commencement</label>
            <input
              type="date"
              class="form-control"
              [(ngModel)]="commencementDate"
              (change)="bindCommencementDate()"
            >
          </div>
        </div>

        <div class="mt-3 fw-bold">
          <h5 class="section-title">Zone Classification & Compounded Licence Fees</h5>
          <div class="row g-3">
          <div class="col-md-4">
            <label class="required">Zone Classification</label>
            <select class="form-select" [(ngModel)]="selectedZoneClassification">
              <option [ngValue]="null">Select</option>
              <option *ngFor="let zc of zoneClassifications" [ngValue]="zc">
                {{ zc.zonalClassificationName }}
              </option>
            </select>
          </div>
          <div class="col-md-4">
            <label class="required">License Fee Prescribed</label>
            <input type="text" class="form-control" [value]="licenseFee" readonly>
          </div>
        </div>
        </div>

        <div class="d-flex justify-content-between mt-4">
          <button class="btn btn-outline-secondary" (click)="prevStep()">‚Üê Back</button>
          <button class="btn btn-primary" (click)="nextStep()">Continue ‚Üí</button>
        </div>
      </div>

     <!-- ======================================================
     STEP 4 ‚Äì LOCATION
======================================================= -->
<!-- <div *ngIf="currentStep === 4">

  <h5 class="section-title">Road Width Check (Location)</h5>

  
  <input class="form-control mb-1"
         placeholder="Search location (HSR Layout, Bengaluru)"
         [(ngModel)]="searchText"
         (input)="searchLocation()">

  
  <ul class="list-group position-absolute w-100 shadow"
      *ngIf="searchResults.length">
    <li class="list-group-item list-group-item-action"
        *ngFor="let r of searchResults"
        (click)="selectLocation(r)">
      {{ r.display_name }}
    </li>
  </ul>

  <div class="row my-2">
    <div class="col-md-6">
      <input class="form-control" placeholder="Latitude" [value]="latitude" readonly>
    </div>
    <div class="col-md-6">
      <input class="form-control" placeholder="Longitude" [value]="longitude" readonly>
    </div>
  </div>

  <div id="map"></div>

  <div class="d-flex justify-content-between mt-4">
    <button class="btn btn-outline-secondary" (click)="prevStep()">‚Üê Back</button>
    <button class="btn btn-primary" (click)="nextStep()">Continue ‚Üí</button>
  </div>

</div> -->
  <div *ngIf="currentStep === 4">

    <h5 class="section-title">Road Width Check (Location)</h5>

    <div class="row g-3">

      <!-- LEFT PANEL ‚Äì 30% -->
      <div class="col-lg-5 col-md-6 position-relative">

        <!-- SEARCH -->
        <label class="required">Search Location</label>
        <input class="form-control mb-2"
              placeholder="Search location (HSR Layout, Bengaluru)"
              [(ngModel)]="searchText"
              (input)="searchLocation()">

        <!-- SUGGESTIONS -->
        <ul class="list-group location-suggestions"
            *ngIf="searchResults.length">
          <li class="list-group-item list-group-item-action"
              *ngFor="let r of searchResults"
              (click)="selectLocation(r)">
            {{ r.display_name }}
          </li>
        </ul>

        <!-- LOCATION DETAILS -->
        <div class="row mt-4 g-3">
          <div class="col-12">
            <input class="form-control"
                  placeholder="Latitude"
                  [value]="latitude"
                  readonly>
          </div>
          <div class="col-12">
            <input class="form-control"
                  placeholder="Longitude"
                  [value]="longitude"
                  readonly>
          </div>
          <div class="col-12">
            <small class="text-muted">
              Road width is calculated based on selected location
            </small>
            <input class="form-control"
                  placeholder="Road Width (meters)"
                  [value]="roadWidth"
                  readonly>
          </div>
          <div *ngIf="roadWidthStatus" class="mt-2">
            <span class="badge"
                  [class.bg-success]="roadWidthStatus === 'COMPLIANT'"
                  [class.bg-danger]="roadWidthStatus !== 'COMPLIANT'">
              {{ roadWidthStatus }}
            </span>
          </div>
        </div>

      </div>

      <!-- RIGHT PANEL ‚Äì 70% -->
      <div class="col-lg-7 col-md-6">
        <small class="text-muted d-block mb-2">
          üìç Search a place or click anywhere on the map to select a location
        </small>
        <div id="map"></div>
      </div>

    </div>

    <div class="d-flex justify-content-between mt-4">
      <button class="btn btn-outline-secondary" (click)="prevStep()">‚Üê Back</button>
      <button class="btn btn-primary" (click)="nextStep()">Continue ‚Üí</button>
    </div>

  </div>

<!-- ======================================================
     STEP 5 ‚Äì DOCUMENTS & POWER DETAILS
======================================================= -->
<div [hidden]="currentStep !== 5">

  <h5 class="section-title">Documents to be Enclosed</h5>

  <table class="table table-bordered">
    <tr>
      <td class="required">Owner Consent / Lease Agreement</td>
      <td><input type="file" accept="application/pdf"
                 (change)="onFileChange($event,'ownerConsent')"></td>
    </tr>
    <tr>
      <td class="required">Electricity Bill</td>
      <td><input type="file" accept="application/pdf"
                 (change)="onFileChange($event,'electricityBill')"></td>
    </tr>
    <tr>
      <td>Occupancy Certificate</td>
      <td><input type="file" accept="application/pdf"
                 (change)="onFileChange($event,'oc')"></td>
    </tr>
    <tr>
      <td class="required">Neighbour Consent</td>
      <td><input type="file" accept="application/pdf"
                 (change)="onFileChange($event,'neighbour')"></td>
    </tr>
  </table>

  <h5 class="section-title mt-4">Power / Generator Details</h5>

  <div class="row g-3">
    <div class="col-md-6">
      <label>Seeking Power License (HP)</label>
      <input type="number" class="form-control"
             [(ngModel)]="powerHP"
             (input)="calculateFee()">
    </div>

    <div class="col-md-6">
      <label>Installed Generator (HP)</label>
      <input type="number" class="form-control"
             [(ngModel)]="generatorHP"
             (input)="calculateFee()">
    </div>
  </div>

  <div class="alert alert-info mt-3">
    Power Fee (Higher of HP/KVA): ‚Çπ {{ powerFee }}
  </div>

  <div class="d-flex justify-content-between mt-4">
    <button class="btn btn-outline-secondary" (click)="prevStep()">‚Üê Back</button>
    <button class="btn btn-primary" (click)="nextStep()">Send OTP ‚Üí</button>
  </div>

</div>
<!-- ======================================================
     STEP 6 ‚Äì OTP VERIFICATION
======================================================= -->
<div *ngIf="currentStep === 6">

  <h5 class="section-title">OTP Verification</h5>

  <div *ngIf="!otpSent" class="text-center">
    <button class="btn btn-primary"
          (click)="sendOtp()"
          [disabled]="!this.tradeLicenseApplicationDetails.mobileNumber || this.tradeLicenseApplicationDetails.mobileNumber.length !== 10">
      Send OTP
    </button>
  </div>

  <div *ngIf="otpSent && !otpVerified" class="mt-3">
    <label>Enter OTP</label>
    <input class="form-control mb-2"
           [(ngModel)]="otp"
           placeholder="Enter OTP (1234)">
    <button class="btn btn-success" (click)="verifyOtp()">Verify OTP</button>
  </div>

  <div *ngIf="otpVerified" class="alert alert-success mt-3">
    OTP verified successfully.
  </div>

  <div class="d-flex justify-content-between mt-4">
    <button class="btn btn-outline-secondary" (click)="prevStep()">‚Üê Back</button>
    <button class="btn btn-primary"
            (click)="nextStep()">
      Continue ‚Üí
    </button>
    <!-- [disabled]="!otpVerified" -->
  </div>

</div>
<!-- ======================================================
     STEP 7 ‚Äì FINAL PREVIEW
======================================================= -->
<div *ngIf="currentStep === 7">

  <div class="alert alert-success fw-bold text-center">
    ‚úî APPLICATION SUBMITTED SUCCESSFULLY
  </div>

  <h6>Temporary Application No:</h6>
  <strong class="fs-5 text-primary">T4RE1821K</strong>

  <h5 class="section-title mt-4">Trade & Fee Summary</h5>

  <table class="table table-bordered">
    <tr>
      <th>Trade Fee</th>
      <td>‚Çπ {{ totalAmount }}</td>
    </tr>
    <tr>
      <th>Power Fee</th>
      <td>‚Çπ {{ powerFee }}</td>
    </tr>
    <tr>
      <th>OC Exempted Fee</th>
      <td>‚Çπ 500</td>
    </tr>
    <tr class="table-success fw-bold">
      <th>Total Payable</th>
      <td>‚Çπ {{ licenseFee + powerFee + 500 }}</td>
    </tr>
  </table>

  <h5 class="section-title">Select Payment Gateway</h5>

  <div class="form-check">
    <input type="radio" class="form-check-input" checked>
    <label class="form-check-label">BillDesk</label>
  </div>

  <div class="d-flex justify-content-between mt-4">
    <button class="btn btn-outline-secondary" (click)="saveAndPayLater()">
      Save & Pay Later
    </button>
    <button class="btn btn-success btn-lg">
      Proceed for Payment ‚Üí
    </button>
  </div>
</div>