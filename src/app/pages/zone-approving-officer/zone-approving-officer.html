<div class="card table-card">
  <div class="card-body">
    <div class="row g-2 align-items-end mb-3">
      <div class="col-md-3">
        <label class="form-label">Zone</label>
        <select class="form-select" [(ngModel)]="selectedZone" (change)="onZoneChanged()">
          <option value="">All Zones</option>
          <option *ngFor="let zone of zones" [value]="zone">
            {{ zone }}
          </option>
        </select>
      </div>

      <div class="col-md-3">
        <label class="form-label">Ward</label>
        <select class="form-select" [(ngModel)]="selectedWard" (change)="onWardChanged()">
          <option value="">All Wards</option>
          <option *ngFor="let ward of wards" [value]="ward">
            {{ ward }}
          </option>
        </select>
      </div>

      <div class="col-md-3">
        <label class="form-label">Status</label>
        <select class="form-select" [(ngModel)]="selectedStatus" (change)="onStatusChanged()">
          <option value="">All Statuses</option>
          <option *ngFor="let status of statusOptions" [value]="status">
            {{ status }}
          </option>
        </select>
      </div>

      <div class="col-md-3">
        <label class="form-label">Search</label>
        <input
          class="form-control"
          type="text"
          placeholder="Application No / Applicant / Trade / Mobile"
          [(ngModel)]="searchText"
          (ngModelChange)="onSearchChanged()"
        />
      </div>
    </div>

    <div class="mb-3" *ngIf="visibleStatuses.length > 0">
      <small class="text-muted d-block mb-1">Visible Statuses</small>
      <div class="d-flex gap-2 flex-wrap">
        <span class="badge text-bg-secondary" *ngFor="let status of visibleStatuses">
          {{ status }}
        </span>
      </div>
    </div>

    <div class="table-responsive">
      <table class="table table-bordered table-hover mb-0">
        <thead class="table-light">
          <tr>
            <th style="width: 60px;">Sl. No</th>
            <th>Application Number</th>
            <th>Applicant Name</th>
            <th>Trade Name</th>
            <th>Zone</th>
            <th>Ward</th>
            <th>Status</th>
            <th>Submit Date</th>
            <th class="text-center">Action</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngIf="isLoading">
            <td colspan="9" class="text-center py-3">Loading applications...</td>
          </tr>
          <tr *ngFor="let app of pageApplications; let i = index" class="clickable-row" (click)="onOpenApplicationDetails(app)">
            <td>{{ (pageNumber - 1) * pageSize + i + 1 }}</td>
            <td>{{ app.applicationNumber }}</td>
            <td>{{ app.applicantName }}</td>
            <td>{{ app.tradeName }}</td>
            <td>{{ app.mohName }}</td>
            <td>{{ app.wardName }}</td>
            <td>
              <span [class]="getStatusBadgeClass(app.licenceApplicationStatusName)">
                {{ app.licenceApplicationStatusName }}
              </span>
            </td>
            <td>{{ app.applicationSubmitDate | date:'dd-MMM-yyyy' }}</td>
            <td class="text-center">
              <button class="btn btn-outline-primary btn-sm" (click)="onOpenApplicationDetails(app); $event.stopPropagation()">
                Cross Check
              </button>
            </td>
          </tr>
          <tr *ngIf="!isLoading && pageApplications.length === 0">
            <td colspan="9" class="text-center text-muted py-3">
              No zone approver applications found
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="d-flex justify-content-between align-items-center mt-3">
      <div class="text-muted small">
        Showing {{ showingFrom }} - {{ showingTo }} of {{ displayTotalRecords }} records
      </div>

      <div class="d-flex align-items-center gap-2">
        <label class="small text-muted mb-0">Page Size</label>
        <select
          class="form-select form-select-sm page-size-select"
          [ngModel]="pageSize"
          (ngModelChange)="onPageSizeChanged($event)"
        >
          <option *ngFor="let option of pageSizeOptions" [ngValue]="option">
            {{ option }}
          </option>
        </select>

        <nav>
          <ul class="pagination pagination-sm mb-0">
            <li class="page-item" [class.disabled]="pageNumber === 1">
              <button class="page-link" (click)="changePage(pageNumber - 1)">Prev</button>
            </li>
            <li class="page-item" *ngFor="let p of pages" [class.active]="p === pageNumber">
              <button class="page-link" (click)="changePage(p)">{{ p }}</button>
            </li>
            <li class="page-item" [class.disabled]="pageNumber === totalPages">
              <button class="page-link" (click)="changePage(pageNumber + 1)">Next</button>
            </li>
          </ul>
        </nav>
      </div>
    </div>
  </div>
</div>
