<div class="inspection-container">

  <!-- Header -->
  <div class="inspection-header">
    <h4>Inspection</h4>
    <span class="application-no">
      Application No: <strong>{{ applicationNo }}</strong>
    </span>
  </div>

  <!-- Application Summary -->
  <div class="card section-card">
    <div class="card-header">Application Summary</div>
    <div class="card-body summary-grid">
      <div><label>Application Name</label><p>{{ licenceApplicationDetails?.applicantName }}</p></div>
      <div><label>Application Number</label><p>{{ licenceApplicationDetails?.applicationNumber }}</p></div>
      <div><label>Application Date</label><p>{{licenceApplicationDetails?.applicationSubmitDate}}</p></div>
      <div><label>Status</label><p>{{licenceApplicationDetails?.licenceApplicationStatusName}}</p></div>
      <div><label>Trade Licenses Id</label><p>{{licenceApplicationDetails?.tradeLicenceID}}</p></div>
      <div><label>Trade Name</label><p>{{licenceApplicationDetails?.tradeName}}</p></div>
      <div><label>Mobile Number</label><p>{{licenceApplicationDetails?.mobileNumber}}</p></div>
      <div><label>Zone</label><p>{{licenceApplicationDetails?.mohName}}</p></div>
      <div><label>Ward Name</label><p>{{licenceApplicationDetails?.wardName}}</p></div>
    </div>
  </div>

    <!-- Map Details -->
    <div class="card section-card">
      <div class="card-header">Map Details</div>

      <div class="card-body map-grid">
        <!-- Left: Details -->
        <div class="map-form">
          <label>Location</label>
          <!-- <input type="text" class="form-control" [value]="locationName" disabled /> -->

          <label class="mt-2">Latitude</label>
          <input type="text" class="form-control" [value]="loadlocationDetails?.latitude" disabled />

          <label class="mt-2">Longitude</label>
          <input type="text" class="form-control" [value]="loadlocationDetails?.longitude" disabled />

          <label class="mt-2">Road Type</label>
          <input type="text" class="form-control" [value]="loadlocationDetails?.roadID" disabled />

          <label class="mt-2">Road Width (meters)</label>
          <input type="text" class="form-control" [value]="loadlocationDetails?.roadWidthMtrs" disabled />

          <label class="mt-2">Road Category</label>
          <input type="text" class="form-control" [value]="loadlocationDetails?.roadCategory" disabled />
        </div>

        <!-- Right: Map -->
        <google-map
          *ngIf="mapCenter"
          height="350px"
          width="100%"
          [center]="mapCenter"
          [zoom]="18"
          [options]="mapOptions"
        >
          <map-marker
            [position]="mapCenter"
            [options]="markerOptions">
          </map-marker>
        </google-map>
      </div>
    </div>


  <!-- Documents Details -->
  <div class="card section-card">
    <div class="card-header">Documents Details</div>

    <div class="card-body">
      <div class="row g-3">

        <!-- Document 1 -->
        <div class="col-md-6">
          <div class="document-card">
            <div class="doc-info">
              <i class="bi bi-file-earmark-pdf-fill text-danger"></i>
              <span>Trade License Application</span>
            </div>
            <button
              class="btn btn-outline-primary btn-sm"
              (click)="downloadDocument('APPLICATION')"
            >
              Download
            </button>
          </div>
        </div>

        <!-- Document 2 -->
        <div class="col-md-6">
          <div class="document-card">
            <div class="doc-info">
              <i class="bi bi-file-earmark-pdf-fill text-danger"></i>
              <span>Identity Proof</span>
            </div>
            <button
              class="btn btn-outline-primary btn-sm"
              (click)="downloadDocument('ID_PROOF')"
            >
              Download
            </button>
          </div>
        </div>

        <!-- Document 3 -->
        <div class="col-md-6">
          <div class="document-card">
            <div class="doc-info">
              <i class="bi bi-file-earmark-pdf-fill text-danger"></i>
              <span>Address Proof</span>
            </div>
            <button
              class="btn btn-outline-primary btn-sm"
              (click)="downloadDocument('ADDRESS_PROOF')"
            >
              Download
            </button>
          </div>
        </div>

        <!-- Document 4 -->
        <div class="col-md-6">
          <div class="document-card">
            <div class="doc-info">
              <i class="bi bi-file-earmark-pdf-fill text-danger"></i>
              <span>Fire Safety Certificate</span>
            </div>
            <button
              class="btn btn-outline-primary btn-sm"
              (click)="downloadDocument('FIRE_NOC')"
            >
              Download
            </button>
          </div>
        </div>

      </div>
    </div>
  </div>


  <!-- Checklist -->
  <div class="card section-card">
    <div class="card-header">Inspection Checklist</div>
    <div class="card-body">
      <div
        class="form-check checklist-item"
        *ngFor="let item of inspectionChecklist"
      >
        <input
          class="form-check-input"
          type="checkbox"
          [(ngModel)]="item.checked"
        />
        <label class="form-check-label">
          {{ item.label }}
        </label>
      </div>
    </div>
  </div>

  <!-- On-Site Inspection Photos -->
  <div class="card section-card">
    <div class="card-header d-flex justify-content-between align-items-center">
      <span>On-Site Inspection Photos</span>

      <!-- Hidden Camera / File Input -->
      <input
        type="file"
        #cameraInput
        accept="image/*"
        capture="environment"
        multiple
        hidden
        (change)="onPhotosSelected($event)"
      />

      <!-- Plus Button -->
      <button
        class="btn btn-outline-primary btn-sm"
        (click)="cameraInput.click()"
      >
        <i class="bi bi-plus-lg"></i> Add Photo
      </button>
    </div>

    <div class="card-body">
      <div class="row g-3" *ngIf="inspectionPhotos.length > 0; else noPhotos">

        <div
          class="col-md-3 col-sm-4 col-6"
          *ngFor="let photo of inspectionPhotos; let i = index"
        >
          <div class="photo-card">
            <img
              [src]="photo.preview"
              class="img-fluid rounded photo-preview"
              alt="Inspection Photo"
            />


            <button
              class="btn btn-sm btn-danger remove-photo"
              (click)="removePhoto(i)"
              title="Remove"
            >
              <i class="bi bi-x-lg"></i>
            </button>
          </div>
        </div>

      </div>

      <ng-template #noPhotos>
        <p class="text-muted mb-0">
          Tap <strong>+ Add Photo</strong> to capture inspection photos.
        </p>
      </ng-template>
    </div>
  </div>


  <!-- Remarks -->
  <div class="card section-card">
    <div class="card-header">Inspection Remarks</div>
    <div class="card-body">
      <textarea
        class="form-control"
        rows="4"
        [(ngModel)]="remarks"
        placeholder="Enter inspection remarks..."
      ></textarea>
    </div>
  </div>

  <!-- Timeline -->
  <div class="card section-card">
    <div class="card-header">Application Timeline</div>
    <div class="card-body">
      <div *ngIf="timelineLoading" class="text-muted">Loading timeline...</div>
      <div *ngIf="!timelineLoading && timelineError" class="text-danger">
        {{ timelineError }}
      </div>
      <div *ngIf="!timelineLoading && !timelineError && timeline.length === 0" class="text-muted">
        No timeline entries found.
      </div>
      <div *ngIf="!timelineLoading && !timelineError && timeline.length > 0" class="table-responsive">
        <table class="table table-bordered mb-0">
          <thead class="table-light">
            <tr>
              <th style="width: 160px;">Date</th>
              <th style="width: 160px;">Process</th>
              <th>Remarks</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of timeline">
              <td>{{ item.entryDate | date:'dd-MMM-yyyy HH:mm' }}</td>
              <td>{{ item.licenceProcessName }}</td>
              <td>{{ item.remarks || '-' }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Actions -->
  <div class="inspection-actions">
    <button class="btn btn-secondary" (click)="cancel()">Cancel</button>
    <button class="btn btn-outline-primary" (click)="saveDraft()">
      Save Draft
    </button>
    <button *ngIf="!isSeniorApprover" class="btn btn-success" [disabled]="isSubmitting" (click)="submitProcessAction(7, 3)">
      Submit Inspection
    </button>
    <button *ngIf="!isSeniorApprover" class="btn btn-warning text-dark" [disabled]="isSubmitting" (click)="submitProcessAction(6, 3)">
      Forward
    </button>
    <button *ngIf="!isSeniorApprover" class="btn btn-danger" [disabled]="isSubmitting" (click)="submitProcessAction(4, 3)">
      Reject
    </button>

    <button *ngIf="isSeniorApprover" class="btn btn-success" [disabled]="isSubmitting" (click)="submitProcessAction(3, 3)">
      Approve
    </button>
    <button *ngIf="isSeniorApprover" class="btn btn-warning text-dark" [disabled]="isSubmitting" (click)="submitProcessAction(6, 3)">
      Forward
    </button>
    <button *ngIf="isSeniorApprover" class="btn btn-danger" [disabled]="isSubmitting" (click)="submitProcessAction(4, 3)">
      Reject
    </button>
    <button *ngIf="isSeniorApprover" class="btn btn-outline-secondary" [disabled]="isSubmitting" (click)="submitProcessAction(5, 3)">
      Objection
    </button>
  </div>

</div>
