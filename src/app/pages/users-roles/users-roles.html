<!-- ================= PAGE HEADER ================= -->
<div class="page-header">
  <div class="title-block">
    <h2>Manage Users & Roles</h2>
    <p>Configure user access, roles, and office mapping</p>
  </div>

  <button class="btn-primary" (click)="addNewUser()">
    <i class="bi bi-plus-lg"></i>
    Add User
  </button>
</div>

<!-- ================= SEARCH ================= -->
<!-- <div class="card search-card">
  <i class="bi bi-search"></i>
  <input
    type="text"
    placeholder="Search by Login / Mobile / Designation"
    [(ngModel)]="searchText"
    (input)="onSearchChange()" />
  <button *ngIf="searchText" class="clear-btn" (click)="clearSearch()">✕</button>
</div> -->

<!-- ================= ADD / EDIT FORM ================= -->
<div class="card form-card" *ngIf="selectedUser">
  <div class="form-header">
    <h3>{{ isEditMode ? 'Update User' : 'Add New User' }}</h3>
    <span>User credentials and office assignment</span>
  </div>

  <div class="form-grid">
    <div class="form-group">
      <label>User Name</label>
      <input type="text" [(ngModel)]="selectedUser.login" [disabled]="isEditMode" />
    </div>

    <div class="form-group">
      <label>Password</label>
      <input type="password" [(ngModel)]="selectedUser.password" [disabled]="isEditMode" />
    </div>

    <div class="form-group">
      <label>Mobile Number</label>
      <input type="text" [(ngModel)]="selectedUser.MobileNo" />
    </div>

    <div class="form-group">
      <label>Zone</label>
      <select [(ngModel)]="selectedUser.zoneID">
        <option value="0">Select Zone</option>
        <option *ngFor="let z of zones" [value]="z.zoneID">
          {{ z.zoneName }}
        </option>
      </select>
    </div>

    <div class="form-group">
      <label>Office</label>
      <select [(ngModel)]="selectedUser.officeDetailsID">
        <option value="0">Select Office</option>
        <option *ngFor="let o of officeList" [value]="o.officeID">
          {{ o.officeName }}
        </option>
      </select>
    </div>

    <div class="form-group">
      <label>Designation</label>
      <select [(ngModel)]="selectedUser.userDesignationID">
        <option value="0">Select Designation</option>
        <option *ngFor="let d of designationList" [value]="d.userDesignationId">
          {{ d.userDesignationName }}
        </option>
      </select>
    </div>

    <div class="form-group">
      <label>Sakala DO Code</label>
      <input type="text" [(ngModel)]="selectedUser.sakalaDO_Code" />
    </div>
  </div>

  <div class="form-actions">
    <button class="btn-primary" (click)="saveUser()">
      {{ isEditMode ? 'Update User' : 'Save User' }}
    </button>
    <button class="btn-secondary" (click)="selectedUser = null">
      Cancel
    </button>
  </div>
</div>

<!-- ================= USERS TABLE ================= -->
<div class="card table-card">
   <!-- TABLE HEADER WITH SEARCH -->
    <div class="table-header">
      <h3>User List</h3>

      <div class="table-search">
        <i class="bi bi-search"></i>
        <input
          type="text"
          placeholder="Search users..."
          [(ngModel)]="searchText"
          (input)="onSearchChange()" />
        <button *ngIf="searchText" class="clear-btn" (click)="clearSearch()">✕</button>
      </div>
    </div>
  <table class="data-table">
    <thead>
      <tr>
        <th>Login</th>
        <th>Mobile</th>
        <th>Office</th>
        <th>Designation</th>
        <th class="center">Actions</th>
      </tr>
    </thead>

    <tbody>
      <tr *ngFor="let u of users">
        <td>{{ u.login }}</td>
        <td>{{ u.MobileNo }}</td>
        <td>{{ getOfficeName(u.officeDetailsID) }}</td>
        <td>{{ getDesignationName(u.userDesignationID) }}</td>
        <td class="center">
          <button class="icon-btn edit" (click)="editUser(u)">
            <i class="bi bi-pencil"></i>
          </button>
          <button class="icon-btn delete" (click)="deleteUser(u.loginID)">
            <i class="bi bi-trash"></i>
          </button>
        </td>
      </tr>

      <tr *ngIf="users.length === 0">
        <td colspan="5" class="no-data">No users found</td>
      </tr>
    </tbody>
  </table>
</div>

<!-- ================= PAGINATION ================= -->
<div class="pagination" *ngIf="totalRecords > pageSize">
  <button class="btn-secondary" (click)="prevPage()" [disabled]="pageNumber === 1">
    Previous
  </button>
  <span>Page {{ pageNumber }} of {{ totalPages }}</span>
  <button class="btn-secondary" (click)="nextPage()" [disabled]="pageNumber >= totalPages">
    Next
  </button>
</div>
